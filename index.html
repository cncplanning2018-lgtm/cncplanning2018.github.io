<script>
  AFRAME.registerComponent('ar-manager', {
    init: function () {
      this.models = [
        document.querySelector('#model-dog'),   // 0
        document.querySelector('#model-sheep'), // 1
        document.querySelector('#model-ele')    // 2
      ];
      this.infoBoard = document.querySelector('#info-board');
      this.effect = document.querySelector('#magic-particle');
      this.index = 0;
      this.isFinished = false;

      // 各モデルに個別でクリックイベントを付与
      this.models.forEach((model, i) => {
        model.addEventListener('click', () => {
          if (this.isFinished) return;
          if (i !== this.index) return; // 現在のインデックスのモデルだけ反応

          // エフェクト
          this.effect.setAttribute('visible', true);
          this.effect.emit('burst');

          setTimeout(() => {
            // 現在のモデルを隠す
            model.setAttribute('visible', false);

            this.index++;
            if (this.index < this.models.length) {
              this.models[this.index].setAttribute('visible', true);
            } else {
              this.infoBoard.setAttribute('visible', true);
              this.isFinished = true;
            }
          }, 100);

          // エフェクト隠す
          setTimeout(() => {
            this.effect.setAttribute('visible', false);
          }, 800);
        });
      });
    }
  });
</script>
